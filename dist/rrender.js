class superxmlparser74{static parse(l,e,t,s,f=()=>{}){let a=!1,r=!1,n="",u="",c="",o=!1,p="",m=[],g="";for(let i=0;i<=l.length-1;i++){if("<"===l[i]){if("!"===l[i+1]&&"-"===l[i+2]&&"-"===l[i+3]){for(let e=i+4;e<=l.length-1;e++)if("-"===l[e]&&"-"===l[e+1]&&">"===l[e+2]){i=e+2;break}continue}if(""!==n.trim()&&"\n"!==n.trim()&&"\t"!==n.trim()?(t({value:n}),n=""):"/"!==l[i+1]&&t({value:""}),a=!0,"/"===l[i+1]){a=!1,i+=1;continue}}else if(">"===l[i])a?("/"===g?f:e)({tag:n,attr:m}):s({}),m=[],n="",r=!1,a=!1;else if(!r&&" "!==l[i]||!a)n+=l[i];else if(r)if("="===l[i])u=p,p="";else if('"'===l[i]){if(!1===(o=!o)&&(c="class"===u?p.split(" "):[p],p="",m.push({key:u,value:c})," "===l[i+1])){i+=1;continue}}else p+=l[i];else" "===l[i]&&a&&(r=!0);g=l[i]}}}
class node{id;childrens=[];innerTEXT="";parent=[];numChild=0;tag;closedtag;visible=!0;rIf=!1;attr=[];parentComponent="";left;right;rName}class BuilderDOM{build(e){var t="<dom>";return this._html_to_dom(t+e+"\n </dom>")}_html_to_dom(e){let l=[],p=[],o=0,i=[];let m=[],h,s=[];return superxmlparser74.parse(e,e=>{var t=JSON.stringify([m]),n="false"===e.attr.find(e=>"r-if"==e.key)?.value[0];let r="";var a=e.attr.find(e=>"r-name"==e.key)?.value[0],a=(a?(h=e.attr.find(e=>"r-name"==e.key)?.value[0],s.push({type:"component",component:h})):s.push({type:"div",component:null,remove:n}),r=n?void 0:a?a+"#component":(null==i[t]?i[t]=0:i[t]++,`_${m.join("-")}#`+i[t]),new node);a.attr=e.attr,a.tag=e.tag.trim(),a.numChild=i[t],a.parent=JSON.parse(JSON.stringify(m)),a.parentNode=p[p.length-1],a.id=r,e.attr.find(e=>"r-name"==e.key)?.value[0]||n||m.push(i[t]),a.parentComponent=s.filter(e=>"component"===e.type)[s.filter(e=>"component"===e.type).length-1]?.component,a.left=o++,a.rName=e.attr.find(e=>"r-name"==e.key)?.value[0],l.push(a),a.attr.push({key:"tag",value:[e.tag]}),p[p.length-1]&&"script"!==a.tag&&p[p.length-1].childrens.push(a),p.push(a)},e=>{p[p.length-1]&&(p[p.length-1].innerTEXT+=e.value)},e=>{var t;p.length&&(p[p.length-1].right=o++,t=s.pop(),p.pop(),t.remove||"component"===t.type||m.pop())}),l}}
class dom_node{childrens=[];innerTEXT="";tag}class _template{static render=(t,v)=>{t=_template.html_to_dom(t);let c="",f=[{data:v.state}],k=(e,a)=>{var t;if(a)return"function"==typeof(t=f.find(t=>t.key===a)?.data[e])?t(f[f.length-1].data):t;for(let t=f.length-1;0<=t;t--){var n=f[t]?.data[e];if(void 0!==n)return"function"==typeof n?n(f[f.length-1].data):n}},y=(l,r=null,i=null,s,t)=>{l.tag=l.tag.trim();let e="",a=l?.attr?.find(t=>"r-for"===t.key)?.value[0];var p=l?.attr?.find(t=>"r-if"===t.key)?.value[0];let u=l?.attr?.find(t=>"r-bind"===t.key)?.value[0],o=l?.attr?.find(t=>"r-click"===t.key)?.value[0],g=l?.attr?.find(t=>"r-mouse"===t.key)?.value[0];var d=l?.attr?.find(t=>"r-model"===t.key)?.value[0],m=l?.attr?.filter(t=>t.key.includes("r-bind.")).map(t=>({key:t.key,val:t.value[0]}))?.map(t=>({attr:t.key,val:t.val}));let n;if(a&&!r){1<a.split("of").length&&(e=a.split("of")[0].trim(),a=a.split("of")[1].trim()),1<a.split(".").length&&(n=a.split(".")[0],a=a.split(".")[1]);var h=k(a,n);!h?.length&&components.map(t=>t.name).includes(l.tag)&&(c+=`<${l.tag} r-index="0" r-type="destroy" r-repeat="${a}">`+"\n");for(let t=0;t<=h?.length-1;t++)s=h?.[t],f.push({key:e,data:JSON.parse(JSON.stringify(s))}),y(l,a,t,s),f.pop()}else{let t,e;p&&(l.attr=l?.attr?.filter(t=>"r-if"!==t.key),e="!"===p.split("")[0]?(t=p.split("").filter((t,e)=>0!==e).join(""),!Boolean(k(t))):(t=p,Boolean(k(t))));let a=[];1<=m.length&&(a=m.map(t=>{let e=t.val.split("."),a;return e=1<e.length?(a=e[0],e[1]):t.val,{attr:t.attr.split(".")[1],val:k(e,a)}}));let n;u?.includes(".")&&(n=u.split(".")[0],u=u.split(".")[1]),o=o&&(o.includes(".")?` onclick="runEvent('${v.name}', '${o.split(".")[0]}', '${k(o.split(".")[1])}') "`:` onclick="runEvent('${v.name}', '${o}') "`),g=g&&(g.includes(".")?` onmousemove="runEvent('${v.name}', '${g.split(".")[0]}', '${k(g.split(".")[1])}') "`:` onmousemove="runEvent('${v.name}', '${g}') "`),d&&v.name,c=(c=c+("<"+l.tag+(1<l.attr.length?" ":"")+l.attr.reduce((t,e,a)=>t+("tag"!==e.key?`${e.key}="${e.value.join(" ")}"`+(l.attr.length-1!=a+1?" ":""):""),"")+(p?` r-key="${t}" r-if="${e}" `:"")+(r?` r-repeat="${r}" r-index="${i}"`:"")+(a.length?a.map(t=>{if(t?.attr)return` ${t.attr}="${t.val}" `;u=t.val}).filter(t=>t).join(" "):"")+(o||"")+(g||"")+">")+"\n")+(l.innerTEXT??"")+"\n",u&&(c=c+k(u,n)+"\n"),l.childrens.forEach(t=>{y(t,null,null,s)}),components.map(t=>t.name).includes(l.tag)||(c=c+("</"+l.tag)+">\n")}};return y(t[0],null,null,v.state),c};static html_to_dom=t=>{var a=function(t){return["noscript","link","base","meta","input","svg","path","img","br","area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(t)};let n=[],l=[];return superxmlparser74.parse(t,t=>{"p"===t.tag&&"p"===l[l.length-1]?.tag&&l.pop();var e=new dom_node;e.attr=t.attr,e.tag=t.tag,n.push(e),e.attr.push({key:"tag",value:[t.tag]}),l[l.length-1]&&"script"!==e.tag&&l[l.length-1].childrens.push(e),a(e.tag)||l.push(e)},t=>{l[l.length-1]&&(l[l.length-1].innerTEXT+=t.value)},t=>{l.pop()},t=>{var e=new dom_node;e.attr=t.attr,e.tag=t.tag,n.push(e),l[l.length-1].childrens.push(e),e.attr.push({key:"tag",value:[t.tag]})}),n}}
var domBuilder=new BuilderDOM,currentComponents=[],components={};class component{name="";index=null;propKey=null;constructor(e){this.name=e}get _body(){return this.propKey&&0===getProps(this.parent,this.propKey)?.length?"":this.body()}body(){}init(){}destroy(){}getProps=e=>void 0===this.index?getProps(this.parent,e):getProps(this.parent,this.propKey,this.index)}var _currentDom="";class render{init=!0;vdom=[];prevVdom=[];hiddenEls=[];prevComponents=[];_el={};constructor(e,n){components=n,this._el=e,_currentDom=this._el.innerHTML.trim().split("\n")}renderDom(){var h="",c=[];let u=[];let f=[],v=[];if(this.prevVdom){let r=n=>{var e,t;"true"==n?.attr?.find(e=>"r-if"===e.key)?.value[0]&&(t=n?.attr?.find(e=>"r-key"===e.key)?.value[0],e=this.prevComponents.find(e=>e.name==n.parentComponent)?.component?.state?.[t],t=currentComponents.find(e=>e.name==n.parentComponent)?.component?.state?.[t],void 0!==e)&&t!=e&&v.push(...this.prevVdom.filter(e=>n.left<e.left&&n.right>e.right)?.filter(e=>e?.id?.includes("component"))?.map(e=>e.attr?.find(e=>"r-name"===e.key)?.value[0])),n?.childrens?.forEach(e=>{r(e)})};r(this.prevVdom[0])}_currentDom.forEach(e=>{let l=e=>{var t=this.utils.parseTag(e);let r=t?.tag?.trim();var i=t?.attr?.find(e=>"r-index"==e.key)?.value[0],s=t?.attr?.find(e=>"r-repeat"==e.key)?.value[0],t=(t?.attr?.find(e=>"r-if"==e.key)?.value[0],t?.attr?.find(e=>"r-type"==e.key)?.value[0]);if(this.utils.isComponent(r)){var a=c.join(".")+("#"+r);void 0===u[a]&&(u[a]=0),u[a]++;let n=a+"-"+u[a];if(v.includes(n))currentComponents.filter(e=>e.hierarchy?.split(".")?.includes(n)).forEach(n=>{n.component.destroy(),currentComponents=currentComponents.filter(e=>e.name!==n.name)});else{if(s){let n=currentComponents.find(e=>e.name==c[c.length-1]).component;var o=this.prevComponents.find(e=>e.name==n.name)?.component.state[s],p=n?.state?.[s];o?.length<p?.length&&(n.state=this.utils.setIndexes(n.state))}if(s&&this.prevComponents.find(e=>e.name==n)){let o=currentComponents.find(e=>e.name==c[c.length-1]).component;if(!f.includes(o.name)){f.push(o.name);var d=this.prevComponents.find(e=>e.name==o.name).component.state[s];let n=o.state[s],r=d.map(e=>e.index).filter(e=>!n.map(e=>e.index).includes(e)),i=0;for(let e=0;e<=d.length-1;e++){i++;let n=a+"-"+(u[a]+e),t=currentComponents.find(e=>e.name==n);if(r.includes(e))o.state=this.utils.setIndexes(o.state),i--,currentComponents.filter(e=>e.hierarchy?.split(".")?.includes(t.name)).forEach(n=>{n.component.destroy(),currentComponents=currentComponents.filter(e=>e.name!==n.name)});else{var m=t.name;let e=t.name.split("-");e.pop(),e=e.join("-"),t.name=e+"-"+i,t.component.index=i-1,t.component.name=t.name;for(let e=0;e<=currentComponents.length-1;e++)currentComponents[e].hierarchy=currentComponents[e].hierarchy?.split(m).join(t.name)}}}}let e=currentComponents.find(e=>e.name===n);c.push(n),"destroy"!=t&&(e?e=e.component:(o=components.find(e=>e.name===r).component,e=new o(n),currentComponents.push({name:n,component:e,hierarchy:c.join(".")}),e.name=n,e.index=i,e.propKey=s,e.parent=c[c.length-2],e.init(),e.state=this.utils.setIndexes(e.state)),p=_template.render(e._body,e),h+=`<div r-name="${n}">`,p.split("\n").forEach(e=>{l(e)}),h+=`</div r-name="${n}">`,c.pop(n))}}else h+=e+"\n"};l(e)});let i="",o=(r,e=!1)=>{r&&"false"!=r?.attr?.find(e=>"r-if"===e.key)?.value[0]&&((e=r?.attr?.find(e=>"r-name"===e.key)?.value[0]?!0:e)||(i=(i+="<"+r.tag+(1<r.attr.length?" ":"")+r.attr.filter(e=>!e.key.includes("r-")).reduce((e,n,t)=>e+("tag"!==n.key?`${n.key}="${n.value.join(" ")}"`+(r.attr.length-1!=t+1?" ":""):""),"")+">")+r.innerTEXT),r.childrens.forEach(e=>{o(e)}),e||(i+="</"+r.tag+">"))};if(this.init)this.vdom=domBuilder.build(h),o(this.vdom[0],!0),this._el.innerHTML=i,this.init=!1,this.prevVdom=this.vdom;else{let t=t=>{let r=this._el;for(let n=1;n<=t.length-1;n++){let e;e=Number(t[n])===t[n]?t[n]:this.vdom.find(e=>e.id==t[n]).numChild,r.children[e]&&(r=r.children[e])}return r};var l=[];this.vdom=domBuilder.build(h);let m=n=>{if(n){let t=this.vdom.find(e=>e.id==n),r=this.prevVdom.find(e=>e.id==n);var e=t?.childrens?.length,i=r?.childrens?.length,o=[],s=i<e?e:i;for(let n=0;n<=s-1;n++){var a=this.vdom.find(e=>e.id==t?.childrens[n]?.id),p=this.prevVdom.find(e=>e.id==r?.childrens[n]?.id),d={...a,childrens:"",parentComponent:"",parentNode:"",left:"",right:""},p={...p,childrens:"",parentComponent:"",parentNode:"",left:"",right:""};if(JSON.stringify(d)!==JSON.stringify(p))return r.id.includes("component")&&(r=r.parentNode,t=t.parentNode),void l.push({el:t,prev:r,type:"create"});o.push(a.id)}o.forEach(e=>{m(e)})}};m(this.vdom[0].id),l.forEach(e=>{var n=t([...e.prev.parent,e.prev.id]);switch(i="",e.type){case"delete":break;case"create":o(e.el,!0),n.innerHTML=i}}),this.prevVdom=this.vdom,this.prevComponents=JSON.parse(JSON.stringify(currentComponents))}}utils={isComponent(e){return components.map(e=>e.name).includes(e)},parseTag(e){let n={};return superxmlparser74.parse(e,e=>{n=e},()=>{},()=>{},e=>{n=e}),n},setIndexes(n){return Object.keys(n).forEach(e=>{Array.isArray(n[e])&&(n[e]=n[e].map((e,n)=>({...e,index:n})))}),n}}}function runEvent(n,e,t){currentComponents.find(e=>e.name===n).component[e](t),Render.renderDom()}function runParentEvent(n,e,t){let r="";currentComponents.forEach(e=>{(e=e.hierarchy.split("."))[e.length-1]===n&&(r=e[e.length-2])}),runEvent(r,e,t)}function getProps(n,e,t=void 0,r){var i=currentComponents.find(e=>(e=e.hierarchy.split("."))[e.length-1]===n);return void 0!==t?i?.component.state[e]?.[t]:i?.component?.state?.[e]}function model(n,{event:e,key:t}){e=e.target.value;currentComponents.find(e=>(e=e.hierarchy.split("."))[e.length-1]===n).component.state[t]=e,Render.renderDom()}