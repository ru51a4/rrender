class superxmlparser74{static parse(t,e,l,s,a=()=>{}){let f=!1,r=!1,n="",u="",c="",o=!1,p="",m=[],g="";for(let i=0;i<=t.length-1;i++){if("<"===t[i]){if("!"===t[i+1]&&"-"===t[i+2]&&"-"===t[i+3]){for(let e=i+4;e<=t.length-1;e++)if("-"===t[e]&&"-"===t[e+1]&&">"===t[e+2]){i=e+2;break}continue}if(""!==n.trim()&&"\n"!==n.trim()&&"\t"!==n.trim()?(l({value:n}),n=""):"/"!==t[i+1]&&l({value:""}),f=!0,"/"===t[i+1]){f=!1,i+=1;continue}}else if(">"===t[i])f?("/"===g?a:e)({tag:n,attr:m}):s({tag:n.split("\n").join("").trim()}),m=[],n="",r=!1,f=!1;else if(!r&&" "!==t[i]||!f)n+=t[i];else if(r)if("="===t[i])u=p,p="";else if('"'===t[i]){if(!1===(o=!o)&&(c="class"===u?p.split(" "):[p],p="",m.push({key:u,value:c})," "===t[i+1])){i+=1;continue}}else p+=t[i];else" "===t[i]&&f&&(r=!0);g=t[i]}}}
class node{id;childrens=[];innerTEXT="";parent=[];numChild=0;tag;closedtag;visible=!0;rIf=!1;attr=[];parentComponent="";left;right;rName}class BuilderDOM{build(e){var t="<dom>";return this._html_to_dom(t+e+"\n </dom>")}_html_to_dom(e){let l=[],p=[],o=0,i=[];let m=[],h,s=[];return superxmlparser74.parse(e,e=>{var t=JSON.stringify([m]),n="false"===e.attr.find(e=>"r-if"==e.key)?.value[0];let r="";var a=e.attr.find(e=>"r-name"==e.key)?.value[0],a=(a?(h=e.attr.find(e=>"r-name"==e.key)?.value[0],s.push({type:"component",component:h})):s.push({type:"div",component:null,remove:n}),r=n?void 0:a?a+"#component":(null==i[t]?i[t]=0:i[t]++,`_${m.join("-")}#`+i[t]),new node);a.attr=e.attr,a.tag=e.tag.trim(),a.numChild=i[t],a.parent=JSON.parse(JSON.stringify(m)),a.parentNode=p[p.length-1],a.id=r,e.attr.find(e=>"r-name"==e.key)?.value[0]||n||m.push(i[t]),a.parentComponent=s.filter(e=>"component"===e.type)[s.filter(e=>"component"===e.type).length-1]?.component,a.left=o++,a.rName=e.attr.find(e=>"r-name"==e.key)?.value[0],l.push(a),a.attr.push({key:"tag",value:[e.tag]}),p[p.length-1]&&"script"!==a.tag&&p[p.length-1].childrens.push(a),p.push(a)},e=>{p[p.length-1]&&(p[p.length-1].innerTEXT+=e.value)},e=>{var t;p.length&&(p[p.length-1].right=o++,t=s.pop(),p.pop(),t.remove||"component"===t.type||m.pop())}),l}}
class dom_node{childrens=[];innerTEXT="";tag}class _template{static render=(t,v)=>{t=_template.html_to_dom(t);let f="",k=[{data:v.state}],y=(e,a)=>{var t;if(a)return"function"==typeof(t=k.find(t=>t.key===a)?.data[e])?t(k[k.length-1].data):t;for(let t=k.length-1;0<=t;t--){var n=k[t]?.data[e];if(void 0!==n)return"function"==typeof n?n(k[k.length-1].data):n}},$=(l,r=null,i=null,s,t)=>{l.tag=l.tag.trim();let e="",a=l?.attr?.find(t=>"r-for"===t.key)?.value[0];var o=l?.attr?.find(t=>"r-if"===t.key)?.value[0];let p=l?.attr?.find(t=>"r-bind"===t.key)?.value[0],u=l?.attr?.find(t=>"r-click"===t.key)?.value[0],g=l?.attr?.find(t=>"r-mouse"===t.key)?.value[0],d=l?.attr;var m=l?.attr?.find(t=>"r-model"===t.key)?.value[0],h=l?.attr?.filter(t=>t.key.includes("r-bind.")).map(t=>({key:t.key,val:t.value[0]}))?.map(t=>({attr:t.key,val:t.val}));let n;if(a&&!r){1<a.split("of").length&&(e=a.split("of")[0].trim(),a=a.split("of")[1].trim()),1<a.split(".").length&&(n=a.split(".")[0],a=a.split(".")[1]);var c=y(a,n);!c?.length&&components.map(t=>t.name).includes(l.tag)&&(f+=`<${l.tag} r-index="0" r-type="destroy" r-repeat="${a}">`+"\n");for(let t=0;t<=c?.length-1;t++)s=c?.[t],k.push({key:e,data:JSON.parse(JSON.stringify(s))}),$(l,a,t,s),k.pop()}else{let t,e;o&&(d=l?.attr?.filter(t=>"r-if"!==t.key),e="!"===o.split("")[0]?(t=o.split("").filter((t,e)=>0!==e).join(""),console.log({if_key:t}),!Boolean(y(t))):(t=o,Boolean(y(t))));let a=[];1<=h.length&&(a=h.map(t=>{let e=t.val.split("."),a;return e=1<e.length?(a=e[0],e[1]):t.val,{attr:t.attr.split(".")[1],val:y(e,a)}}));let n;p?.includes(".")&&(n=p.split(".")[0],p=p.split(".")[1]),u=u&&(u.includes(".")?` onclick="runEvent('${v.name}', '${u.split(".")[0]}', '${y(u.split(".")[1])}') "`:` onclick="runEvent('${v.name}', '${u}') "`),g=g&&(g.includes(".")?` onmousemove="runEvent('${v.name}', '${g.split(".")[0]}', '${y(g.split(".")[1])}') "`:` onmousemove="runEvent('${v.name}', '${g}') "`),m&&v.name,f=(f=f+("<"+l.tag+(1<d.length?" ":"")+d.reduce((t,e,a)=>t+("tag"!==e.key?`${e.key}="${e.value.join(" ")}"`+(d.length-1!=a+1?" ":""):""),"")+(o?` r-key="${t}" r-if="${e}" `:"")+(r?` r-repeat="${r}" r-index="${i}"`:"")+(a.length?a.map(t=>{if(t?.attr)return` ${t.attr}="${t.val}" `;p=t.val}).filter(t=>t).join(" "):"")+(u||"")+(g||"")+">")+"\n")+(l.innerTEXT??"")+"\n",p&&(f=f+y(p,n)+"\n"),l.childrens.forEach(t=>{$(t,null,null,s)}),components.map(t=>t.name).includes(l.tag)||(f=f+("</"+l.tag)+">\n")}};return $(t[0],null,null,v.state),console.log({html:f}),f};static html_to_dom=t=>{var a=function(t){return["noscript","link","base","meta","input","svg","path","img","br","area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(t)};let n=[],l=[];return superxmlparser74.parse(t,t=>{"p"===t.tag&&"p"===l[l.length-1]?.tag&&l.pop();var e=new dom_node;e.attr=t.attr,e.tag=t.tag,n.push(e),e.attr.push({key:"tag",value:[t.tag]}),l[l.length-1]&&"script"!==e.tag&&l[l.length-1].childrens.push(e),a(e.tag.split("\n").join("").trim())||l.push(e)},t=>{l[l.length-1]&&(l[l.length-1].innerTEXT+=t.value)},t=>{a(t.tag)||l.pop()},t=>{var e=new dom_node;e.attr=t.attr,e.tag=t.tag,n.push(e),l[l.length-1].childrens.push(e),e.attr.push({key:"tag",value:[t.tag]})}),n}}
var domBuilder=new BuilderDOM,currentComponents=[],components={};class component{name="";index=null;propKey=null;constructor(e){this.name=e}get _body(){return this.propKey&&0===getProps(this.parent,this.propKey)?.length?"":this.body()}body(){}init(){}destroy(){}getProps=e=>void 0===this.index?getProps(this.parent,e):getProps(this.parent,this.propKey,this.index)}var _currentDom="";class render{init=!0;vdom=[];prevVdom=[];hiddenEls=[];prevComponents=[];_el={};constructor(e,t){components=t,this._el=e,_currentDom=this._el.innerHTML.trim().split("\n")}renderDom(){var h="",c=[];let u=[];let f=[],v=[];if(this.prevVdom){let r=t=>{var e,n;"true"==t?.attr?.find(e=>"r-if"===e.key)?.value[0]&&(n=t?.attr?.find(e=>"r-key"===e.key)?.value[0],e=this.prevComponents.find(e=>e.name==t.parentComponent)?.component?.state?.[n],n=currentComponents.find(e=>e.name==t.parentComponent)?.component?.state?.[n],void 0!==e)&&n!=e&&v.push(...this.prevVdom.filter(e=>t.left<e.left&&t.right>e.right)?.filter(e=>e?.id?.includes("component"))?.map(e=>e.attr?.find(e=>"r-name"===e.key)?.value[0])),t?.childrens?.forEach(e=>{r(e)})};r(this.prevVdom[0])}_currentDom.forEach(e=>{let m=e=>{var n=this.utils.parseTag(e);let r=n?.tag?.trim();var i=n?.attr?.find(e=>"r-index"==e.key)?.value[0],s=n?.attr?.find(e=>"r-repeat"==e.key)?.value[0],n=(n?.attr?.find(e=>"r-if"==e.key)?.value[0],n?.attr?.find(e=>"r-type"==e.key)?.value[0]);if(this.utils.isComponent(r)){var a=c.join(".")+("#"+r);void 0===u[a]&&(u[a]=0),u[a]++;let t=a+"-"+u[a];if(v.includes(t))currentComponents.filter(e=>e.hierarchy?.split(".")?.includes(t)).forEach(t=>{t.component.destroy(),currentComponents=currentComponents.filter(e=>e.name!==t.name)});else{if(s){let t=currentComponents.find(e=>e.name==c[c.length-1]).component;var o=this.prevComponents.find(e=>e.name==t.name)?.component.state[s],d=t?.state?.[s];o?.length<d?.length&&(t.state=this.utils.setIndexes(t.state))}if(s&&this.prevComponents.find(e=>e.name==t)){let o=currentComponents.find(e=>e.name==c[c.length-1]).component;if(!f.includes(o.name)){f.push(o.name);var p=this.prevComponents.find(e=>e.name==o.name).component.state[s];let t=o.state[s],r=p.map(e=>e.index).filter(e=>!t.map(e=>e.index).includes(e)),i=0;for(let e=0;e<=p.length-1;e++){i++;let t=a+"-"+(u[a]+e),n=currentComponents.find(e=>e.name==t);if(r.includes(e))o.state=this.utils.setIndexes(o.state),i--,currentComponents.filter(e=>e.hierarchy?.split(".")?.includes(n.name)).forEach(t=>{t.component.destroy(),currentComponents=currentComponents.filter(e=>e.name!==t.name)});else{var l=n.name;let e=n.name.split("-");e.pop(),e=e.join("-"),n.name=e+"-"+i,n.component.index=i-1,n.component.name=n.name;for(let e=0;e<=currentComponents.length-1;e++)currentComponents[e].hierarchy=currentComponents[e].hierarchy?.split(l).join(n.name)}}}}let e=currentComponents.find(e=>e.name===t);c.push(t),"destroy"!=n&&(e?e=e.component:(o=components.find(e=>e.name===r).component,e=new o(t),currentComponents.push({name:t,component:e,hierarchy:c.join(".")}),e.name=t,e.index=i,e.propKey=s,e.parent=c[c.length-2],e.init(),e.state=this.utils.setIndexes(e.state)),d=_template.render(e._body,e),h+=`<div r-name="${t}">`,d.split("\n").forEach(e=>{m(e)}),h+=`</div r-name="${t}">`,c.pop(t))}}else h+=e+"\n"};m(e)});let o="";var t={noEndTag(e){return["noscript","link","base","meta","input","svg","path","img","br","area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(e)}};let s=(r,e=!1)=>{r&&"false"!=r?.attr?.find(e=>"r-if"===e.key)?.value[0]&&((e=r?.attr?.find(e=>"r-name"===e.key)?.value[0]?!0:e)||(o=(o+="<"+r.tag+(1<r.attr.length?" ":"")+r.attr.filter(e=>!e.key.includes("r-")).reduce((e,t,n)=>e+("tag"!==t.key?`${t.key}="${t.value.join(" ")}"`+(r.attr.length-1!=n+1?" ":""):""),"")+">")+r.innerTEXT),r.childrens.forEach(e=>{s(e)}),t.noEndTag(r.tag)||e||(o+="</"+r.tag+">"))};if(this.init)this.vdom=domBuilder.build(h),s(this.vdom[0],!0),this._el.innerHTML=o,this.init=!1,this.prevVdom=this.vdom;else{let i=n=>{let r=this._el;for(let t=1;t<=n.length-1;t++){let e;e=Number(n[t])===n[t]?n[t]:this.prevVdom.find(e=>e.id==n[t]).numChild,r.children[e]&&(r=r.children[e])}return r};var y=[];this.vdom=domBuilder.build(h);let m=t=>{if(t){let n=this.vdom.find(e=>e.id==t),r=this.prevVdom.find(e=>e.id==t);var e=n?.childrens?.length,s=r?.childrens?.length,a=[],d=s<e?e:s;let i=0,o=0;for(let e=0;e<=d-1;e++){let e=this.vdom.find(e=>e.id==n?.childrens[i]?.id),t=this.prevVdom.find(e=>e.id==r?.childrens[o]?.id);for(;i<=d-1&&"false"===e?.attr?.find(e=>"r-if"===e.key)?.value[0];)i++,e=this.vdom.find(e=>e.id==n?.childrens[i]?.id);for(i++;o<=d-1&&"false"===t?.attr?.find(e=>"r-if"===e.key)?.value[0];)o++,t=this.prevVdom.find(e=>e.id==r?.childrens[o]?.id);o++;var p={...e,childrens:"",parentComponent:"",parentNode:"",left:"",right:""},l={...t,childrens:"",parentComponent:"",parentNode:"",left:"",right:""};if(!r.id.includes("component")){if(!e){y.push({t:e,tt:t,el:n,prev:r,type:"delete"});continue}if(!t){y.push({t:e,tt:t,el:n,prev:r,type:"add"});continue}JSON.stringify(p)!==JSON.stringify(l)&&(r.id.includes("component")&&(r=r.parentNode,n=n.parentNode),y.push({t:e,tt:t,el:n,prev:r,type:"create"}))}a.push(e.id)}a.forEach(e=>{m(e)})}};m(this.vdom[0].id),y.forEach(e=>{let t;switch(o="",e.type){case"delete":(t=i([...e.tt.parent,e.tt.id])).remove();break;case"create":t=i([...e.tt.parent,e.tt.id]),s(e.t),t.innerHTML=o;break;case"add":t=i([...e.t.parent]),s(e.t),t.appendChild((n=o,(r=document.createElement("div")).innerHTML=n.trim(),r.firstChild))}var n,r}),this.prevVdom=this.vdom,this.prevComponents=JSON.parse(JSON.stringify(currentComponents))}}utils={isComponent(e){return components.map(e=>e.name).includes(e)},parseTag(e){let t={};return superxmlparser74.parse(e,e=>{t=e},()=>{},()=>{},e=>{t=e}),t},setIndexes(t){return Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=t[e].map((e,t)=>({...e,index:t})))}),t}}}function runEvent(t,e,n){currentComponents.find(e=>e.name===t).component[e](n),Render.renderDom()}function runParentEvent(t,e,n){let r="";currentComponents.forEach(e=>{(e=e.hierarchy.split("."))[e.length-1]===t&&(r=e[e.length-2])}),runEvent(r,e,n)}function getProps(t,e,n=void 0,r){var i=currentComponents.find(e=>(e=e.hierarchy.split("."))[e.length-1]===t);return void 0!==n?i?.component.state[e]?.[n]:i?.component?.state?.[e]}function model(t,{event:e,key:n}){e=e.target.value;currentComponents.find(e=>(e=e.hierarchy.split("."))[e.length-1]===t).component.state[n]=e,Render.renderDom()}